:root{
  --bg: #F6E8A6;
  --ii-max-w: 520px;

  --btn-bg: #8FA394;
  --btn-bg-hover: #7E9686;
  --btn-text: #FFFFFF;
  --btn-disabled-bg: #C9CEC9;
  --btn-disabled-text: #FFFFFF;

  --shadow: 0 22px 60px rgba(0,0,0,0.12);
  --shadow-soft: 0 14px 34px rgba(0,0,0,0.12);
  --shadow-layer: 0 18px 46px rgba(0,0,0,0.12);
  --radius: 999px;
}

*{ box-sizing:border-box; }
html, body{ height:100%; }

body{
  margin:0;
  background: var(--bg);
  overflow-x:hidden;
  font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
}

#daisy-layer{
  position: fixed;
  inset: 0;
  z-index: 1;
  pointer-events: none;
  overflow: hidden;
}

.daisy{
  position:absolute;
  left:0;
  top:0;
  opacity:0;
  transform: translate3d(0,0,0) rotate(0deg);
  will-change: transform, opacity;
  width: 56px;
  height: 56px;
  filter: drop-shadow(0 10px 18px rgba(0,0,0,0.08));
}

.page{
  position: relative;
  z-index: 2;
  min-height: 100vh;
  display:flex;
}

.ii{
  width:100%;
  padding: clamp(28px,4vw,52px) 0;
  overflow:hidden;
}

.ii__wrap{
  width:min(1200px,100%);
  margin:0 auto;
  padding:0 20px;
  min-height: min(860px, 100vh);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap: clamp(18px,3vw,26px);
}

.ii__stage{
  width:100%;
  flex: 1 1 auto;
  min-height: clamp(420px,58vh,680px);
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
}

.ii__stage-inner{
  width: min(var(--ii-max-w), 92vw);
  position:relative;
  display:flex;
  align-items:center;
  justify-content:center;
  transform: translateZ(0);
}

.ii__img{
  display:block;
  width:100%;
  height:auto;
  user-select:none;
  -webkit-user-drag:none;
  pointer-events:none;
}

.ii__envelope{
  width:100%;
  position:relative;
  filter: drop-shadow(var(--shadow));
  transform-origin: 50% 50%;
  will-change: transform, opacity;
  z-index: 6;
  transform: translateZ(0);
}

.ii__flip{
  width:100%;
  position:relative;
  aspect-ratio: 1 / 1;
  transform-style:preserve-3d;
  transition: transform 700ms cubic-bezier(.2,.8,.2,1);
}

.ii__flip-face{
  position:absolute;
  inset:0;
  backface-visibility:hidden;
  -webkit-backface-visibility:hidden;
}

.ii__flip-back{ transform: rotateY(180deg); }

.ii__envelope.is-flipped .ii__flip--envelope{ transform: rotateY(180deg); }

.ii__piece{
  position:absolute;
  inset:0;
  width:100%;
  height:auto;
  opacity:0;
  pointer-events:none;
  filter: drop-shadow(var(--shadow-soft));
  transition: opacity 220ms ease;
}

.ii[data-state="back"] .ii__piece{ opacity: 1; }
.ii[data-state="opening"] .ii__piece{ opacity: 0; }

.ii[data-state="opening"] .ii__envelope{
  animation: iiEnvelopeExit 1400ms cubic-bezier(.2,.8,.2,1) forwards;
  pointer-events:none;
}

.ii[data-state="opening"] .ii__envelope.ii__envelope--behind{ z-index: 1; }

@keyframes iiEnvelopeExit{
  0%   { transform: translateX(0) rotate(0deg); opacity: 1; }
  38%  { transform: translateX(0) rotate(90deg); opacity: 1; }
  100% { transform: translateX(-46vw) rotate(90deg); opacity: 0; }
}

.ii__invite{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  pointer-events:none;
  z-index: 3;
}

.ii__invite-inner{
  width: min(var(--ii-max-w), 92vw);
  position:relative;
  opacity:0;
  transform: scale(0.92) translateZ(0);
  pointer-events:none;
  transition: opacity 520ms ease, transform 520ms cubic-bezier(.2,.8,.2,1);
  will-change: opacity, transform;
  z-index: 4;
}

.ii[data-state="opening"] .ii__invite-inner{
  opacity:1;
  transform: scale(0.92);
  pointer-events:auto;
  transition-delay: 560ms;
}

.ii[data-state="revealed"] .ii__invite-inner,
.ii[data-state="ready"] .ii__invite-inner{
  opacity:1;
  transform: scale(0.92);
  pointer-events:auto;
  transition-delay: 0ms;
}

.ii__invite-layer{
  position:absolute;
  left:0;
  bottom:0;
  width:100%;
  touch-action:none;
  will-change: transform;
  transform: translate3d(0,0,0);
}

.ii__invite-innercard{
  z-index: 3;
  pointer-events:auto;
  filter: drop-shadow(var(--shadow-layer));
}

.ii__invite-outer{
  z-index: 4;
  pointer-events:auto;
  filter: drop-shadow(var(--shadow-layer));
}

.ii__img--outer{
  width:100%;
  height:auto;
}

.ii__img--inner{
  width:100%;
  height:auto;
}

.ii__flip--card{
  width:100%;
  position:relative;
  transform-style:preserve-3d;
  transition: transform 720ms cubic-bezier(.2,.8,.2,1);
  aspect-ratio: 3 / 4;
}

.ii__card-front{ position:relative; }
.ii__card-back{ transform: rotateY(180deg); }

.ii__invite-innercard.is-flipped .ii__flip--card{
  transform: rotateY(180deg);
}

.ii__controls{
  width:100%;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap: 14px;
  padding-bottom: clamp(16px,3vh,34px);
}

.ii__btn{
  appearance:none;
  border:0;
  cursor:pointer;
  background: var(--btn-bg);
  color: var(--btn-text);
  border-radius: var(--radius);
  padding: 12px 30px;
  min-width: min(340px, 84vw);
  font-size: clamp(16px,2vw,22px);
  line-height:1;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  font-weight: 700;
  box-shadow: 0 18px 44px rgba(0,0,0,0.10);
  transition: transform 160ms ease, background 160ms ease, opacity 160ms ease;
  user-select:none;
  -webkit-tap-highlight-color: transparent;
}

.ii__btn:hover{ background: var(--btn-bg-hover); transform: translateY(-1px); }
.ii__btn:active{ transform: translateY(0); opacity: 0.96; }

.ii__btn.is-disabled,
.ii__btn:disabled{
  cursor:not-allowed;
  background: var(--btn-disabled-bg);
  color: var(--btn-disabled-text);
  opacity: 0.92;
  transform: none;
}

.ii__restart{
  appearance:none;
  border:0;
  cursor:pointer;
  background: transparent;
  display:flex;
  align-items:center;
  justify-content:center;
  width: 56px;
  height: 56px;
  border-radius: 999px;
  box-shadow: 0 14px 34px rgba(0,0,0,0.10);
  transition: transform 160ms ease, opacity 160ms ease;
  user-select:none;
  -webkit-tap-highlight-color: transparent;
}

.ii__restart:hover{ transform: translateY(-1px); }
.ii__restart:active{ transform: translateY(0); opacity: 0.96; }

.ii__restart-dot{
  width: 12px;
  height: 12px;
  border-radius: 999px;
  background: rgba(0,0,0,0.25);
}

@media (max-width: 740px){
  .ii__wrap{ padding: 0 16px; }
  .ii__stage{ min-height: clamp(380px,56vh,620px); }
  .ii__btn{ min-width: min(320px, 90vw); }

  @keyframes iiEnvelopeExit{
    0%   { transform: translateX(0) rotate(0deg); opacity: 1; }
    40%  { transform: translateX(0) rotate(90deg); opacity: 1; }
    100% { transform: translateX(-60vw) rotate(90deg); opacity: 0; }
  }
}

@media (prefers-reduced-motion: reduce){
  .ii__flip,
  .ii__flip--card{
    transition-duration: 1ms !important;
  }
}
